<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Fahmid Nursery & Primary School</title>
    <link rel="stylesheet" href="styles.css">
        <style>
        /* Modal Styles for Subject Assignment */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: var(--space-2xl);
            border-radius: var(--radius-lg);
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-close {
            position: absolute;
            right: var(--space-lg);
            top: var(--space-lg);
            font-size: 28px;
            font-weight: bold;
            color: var(--color-gray-600);
            cursor: pointer;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--color-danger);
        }

        .subject-checkbox-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
            max-height: 400px;
            overflow-y: auto;
            padding: var(--space-md);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background: var(--color-gray-50);
        }

        .subject-checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: white;
            border-radius: var(--radius-sm);
            transition: background 0.2s;
        }

        .subject-checkbox-item:hover {
            background: var(--color-gray-100);
        }

        .subject-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .subject-checkbox-item label {
            cursor: pointer;
            margin: 0;
            font-size: var(--text-sm);
            user-select: none;
        }
        
        /* Session Status Card Styles */
        .session-status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            color: white;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            margin-bottom: var(--space-xl);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .status-header h3 {
            margin: 0;
            font-size: var(--text-xl);
            color: white;
        }

        .status-badge {
            padding: var(--space-xs) var(--space-md);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: var(--text-sm);
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .status-badge.ending-soon {
            background: #ff9800;
            color: white;
        }

        .status-badge.ended {
            background: #f44336;
            color: white;
        }

        .status-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .status-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .status-label {
            font-size: var(--text-xs);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-value {
            font-size: var(--text-lg);
            font-weight: 700;
        }

        .status-alert {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid rgba(255, 152, 0, 0.5);
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
        }

        .status-alert strong {
            display: block;
            margin-bottom: var(--space-xs);
        }

        .status-alert p {
            margin: 0;
            font-size: var(--text-sm);
        }

        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin: var(--space-md) 0;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }

        .alert ul {
            margin: var(--space-sm) 0 0 var(--space-lg);
            padding: 0;
        }

        .alert li {
            margin-bottom: var(--space-xs);
        }
        /* Class Hierarchy Editor Styles */
        .class-hierarchy-editor {
            background: var(--color-gray-50);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-gray-300);
        }

        .hierarchy-section {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .hierarchy-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .hierarchy-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm);
            background: var(--color-gray-50);
            border-radius: var(--radius-sm);
            transition: background 0.2s;
        }

        .hierarchy-item:hover {
            background: var(--color-gray-100);
        }

        .hierarchy-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            font-size: var(--text-sm);
            flex-shrink: 0;
        }

        .hierarchy-input {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-sm);
            font-size: var(--text-base);
            transition: border-color 0.2s;
        }

        .hierarchy-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn-icon {
            padding: var(--space-xs);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .btn-icon.btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-icon.btn-danger:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            color: #0d47a1;
        }
        /* Promotion Period Control */
        .promotion-period-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            background: var(--color-gray-50);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            gap: var(--space-lg);
            flex-wrap: wrap;
        }

        .control-info h3 {
            margin: 0 0 var(--space-xs);
            font-size: var(--text-lg);
            color: var(--color-gray-900);
        }

        .control-info p {
            margin: 0;
            font-size: var(--text-sm);
            color: var(--color-gray-600);
        }

        .control-info p.status-active {
            color: var(--color-success);
            font-weight: 600;
        }

        .control-info p.status-inactive {
            color: var(--color-danger);
            font-weight: 600;
        }

        .control-actions {
            display: flex;
            gap: var(--space-md);
        }

        /* Bulk Actions */
        .bulk-actions {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--color-gray-50);
            border-radius: var(--radius-md);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* Status Badges */
        .status-pending {
            background: #ff9800;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-approved {
            background: #4CAF50;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-rejected {
            background: #f44336;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #2196F3;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Modal Actions */
        .modal-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-gray-300);
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Promotion Details */
        .promotion-details-section {
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--color-gray-50);
            border-radius: var(--radius-md);
        }

        .promotion-details-section h3 {
            margin: 0 0 var(--space-md);
            font-size: var(--text-base);
            color: var(--color-gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pupil-list {
            display: grid;
            gap: var(--space-xs);
        }

        .pupil-list-item {
            padding: var(--space-sm);
            background: white;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .pupil-list-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Override Options */
        .override-section {
            padding: var(--space-lg);
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: var(--radius-md);
            margin-top: var(--space-lg);
        }

        .override-section h3 {
            margin: 0 0 var(--space-md);
            color: #856404;
        }

        .override-controls {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .override-controls .form-group {
            flex: 1;
            min-width: 200px;
        }
        /* Hierarchy Container and List */
.hierarchy-instructions {
    padding: var(--space-lg);
    background: var(--color-gray-100);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-lg);
}

.hierarchy-instructions p {
    margin: 0 0 var(--space-sm);
    color: var(--color-gray-700);
}

.hierarchy-instructions p:last-child {
    margin: 0;
}

.sortable-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    padding: var(--space-md);
    background: white;
    border: 2px dashed var(--color-gray-300);
    border-radius: var(--radius-md);
    min-height: 200px;
}

.hierarchy-item {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md);
    background: var(--color-gray-50);
    border: 2px solid var(--color-gray-300);
    border-radius: var(--radius-md);
    cursor: grab;
    transition: all 0.2s;
    user-select: none;
}

.hierarchy-item:hover {
    background: white;
    border-color: var(--color-primary);
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);
}

.hierarchy-item.dragging {
    opacity: 0.5;
    cursor: grabbing;
}

.drag-handle {
    font-size: 24px;
    color: var(--color-gray-500);
    cursor: grab;
}

.hierarchy-item:active .drag-handle {
    cursor: grabbing;
}

.hierarchy-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--color-primary);
    color: white;
    border-radius: 50%;
    font-weight: 700;
    font-size: var(--text-base);
    flex-shrink: 0;
}

.class-name {
    flex: 1;
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--color-gray-900);
}

.terminal-badge {
    padding: var(--space-xs) var(--space-md);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
}

/* Results Viewing Styles */
.form-row-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-md);
}

@media (max-width: 992px) {
    .form-row-3 {
        grid-template-columns: 1fr;
    }
}

/* Grade color coding */
.grade-A1 { color: #059669; font-weight: 700; }
.grade-B2 { color: #10b981; font-weight: 700; }
.grade-B3 { color: #34d399; font-weight: 700; }
.grade-C4 { color: #3b82f6; font-weight: 700; }
.grade-C5 { color: #60a5fa; font-weight: 700; }
.grade-C6 { color: #93c5fd; font-weight: 700; }
.grade-D7 { color: #f59e0b; font-weight: 700; }
.grade-D8 { color: #fb923c; font-weight: 700; }
.grade-F9 { color: #ef4444; font-weight: 700; }

/* Spinner animation */
.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f4f6;
    border-top-color: #00B2FF;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Export button styling */
button[onclick="exportPupilResults()"] {
    transition: all 0.3s ease;
}

button[onclick="exportPupilResults()"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Comparison section animations */
#session-comparison-section {
    animation: slideDown 0.4s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <button class="hamburger hamburger-portal" id="hamburger" aria-label="Toggle admin menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
    </button>

       <nav class="admin-sidebar" id="admin-sidebar" aria-label="Admin navigation">
        <!-- Sidebar Header -->
        <div class="sidebar-header-modern">
            <div class="sidebar-logo">
                <i data-lucide="graduation-cap" class="sidebar-logo-icon"></i>
                <span class="sidebar-logo-text">Fahmid Admin</span>
            </div>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar-nav-modern">
            <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
                <i data-lucide="layout-dashboard"></i>
                <span>Dashboard</span>
            </a>
            
            <!-- User Management Group -->
            <div class="sidebar-group-modern">
                <button class="sidebar-group-toggle-modern" onclick="toggleSidebarGroup(this)" aria-expanded="true">
                    <div class="group-header-content">
                        <i data-lucide="users"></i>
                        <span>User Management</span>
                    </div>
                    <i data-lucide="chevron-down" class="toggle-icon"></i>
                </button>
                <div class="sidebar-group-content-modern active">
                    <a href="#teachers" class="sidebar-link" data-section="teachers">
                        <i data-lucide="user-check"></i>
                        <span>Teachers</span>
                    </a>
                    <a href="#pupils" class="sidebar-link" data-section="pupils">
                        <i data-lucide="users-2"></i>
                        <span>Pupils</span>
                    </a>
                    <a href="#alumni" class="sidebar-link" data-section="alumni">
                        <i data-lucide="award"></i>
                        <span>Alumni</span>
                    </a>
                </div>
            </div>
            
            <!-- Academic Tasks Group -->
            <div class="sidebar-group-modern">
                <button class="sidebar-group-toggle-modern" onclick="toggleSidebarGroup(this)" aria-expanded="true">
                    <div class="group-header-content">
                        <i data-lucide="book-open"></i>
                        <span>Academic Tasks</span>
                    </div>
                    <i data-lucide="chevron-down" class="toggle-icon"></i>
                </button>
                <div class="sidebar-group-content-modern active">
                    <a href="#classes" class="sidebar-link" data-section="classes">
                        <i data-lucide="school"></i>
                        <span>Classes</span>
                    </a>
                    <a href="#subjects" class="sidebar-link" data-section="subjects">
                        <i data-lucide="book"></i>
                        <span>Subjects</span>
                    </a>
                    <a href="#assign-teachers" class="sidebar-link" data-section="assign-teachers">
                        <i data-lucide="user-plus"></i>
                        <span>Assign Teachers</span>
                    </a>
                    <a href="#result-approvals" data-section="result-approvals" class="sidebar-link">
                    <i data-lucide="clipboard-check"></i>
                    <span>Approve Results</span>
                    </a>
                    <a href="#promotion-requests" class="sidebar-link" data-section="promotion-requests">
                        <i data-lucide="trending-up"></i>
                        <span>Promotion Requests</span>
                    </a>
                </div>
            </div>
            
            <!-- FINANCIAL MANAGEMENT SIDEBAR GROUP -->
<div class="sidebar-group-modern">
  <button class="sidebar-group-toggle-modern" onclick="toggleSidebarGroup(this)" aria-expanded="false">
    <div class="group-header-content">
      <i data-lucide="dollar-sign"></i>
      <span>Finance</span>
    </div>
    <i data-lucide="chevron-down" class="toggle-icon"></i>
  </button>
  
  <div class="sidebar-group-content-modern">
    <a href="#fee-management" data-section="fee-management" class="sidebar-link">
      <i data-lucide="settings"></i>
      <span>Fee Management</span>
    </a>
    
    <a href="#record-payment" data-section="record-payment" class="sidebar-link">
      <i data-lucide="credit-card"></i>
      <span>Record Payment</span>
    </a>
    
    <a href="#outstanding-fees" data-section="outstanding-fees" class="sidebar-link">
      <i data-lucide="alert-circle"></i>
      <span>Outstanding Fees</span>
    </a>
    
    <a href="#financial-reports" data-section="financial-reports" class="sidebar-link">
      <i data-lucide="bar-chart-2"></i>
      <span>Financial Reports</span>
    </a>
  </div>
</div>

            <!-- Reports & Results -->
            <a href="#view-results" class="sidebar-link" data-section="view-results">
                <i data-lucide="bar-chart-3"></i>
                <span>View Results</span>
            </a>
            
             <a href="#audit-log" class="sidebar-link" data-section="audit-log">
             <i data-lucide="shield-check"></i>
             <span>Audit Log</span>
             </a>
            
            <!-- Communications -->
            <a href="#announcements" class="sidebar-link" data-section="announcements">
                <i data-lucide="megaphone"></i>
                <span>Announcements</span>
            </a>
            
            <!-- System -->
            <a href="#settings" class="sidebar-link" data-section="settings">
                <i data-lucide="settings"></i>
                <span>School Settings</span>
            </a>
        </div>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer-modern">
            <a href="index.html" class="sidebar-link sidebar-link-secondary">
                <i data-lucide="arrow-left"></i>
                <span>Back to Site</span>
            </a>
            <a href="#" id="admin-logout" class="sidebar-link sidebar-link-danger">
                <i data-lucide="log-out"></i>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <main class="admin-main" id="main-content">
<!-- Content Wrapper -->
<div class="content-wrapper">
        <div id="dashboard" class="admin-card">
            <h1>Admin Dashboard</h1>
            <p class="section-description">Welcome to the school management system</p>
            <div class="stats-grid">
                <div class="stat-card stat-card-primary">
                    <h3>Total Teachers</h3>
                    <div class="stat-number" id="teacher-count">0</div>
                </div>
                <div class="stat-card stat-card-secondary">
                    <h3>Total Pupils</h3>
                    <div class="stat-number" id="pupil-count">0</div>
                </div>
                <div class="stat-card stat-card-success">
                    <h3>Total Classes</h3>
                    <div class="stat-number" id="class-count">0</div>
                </div>
                <div class="stat-card stat-card-warning">
                    <h3>Announcements</h3>
                    <div class="stat-number" id="announce-count">0</div>
                </div>
            </div>
        </div>

        <!-- Teachers Section -->
        <div id="teachers" class="admin-card" style="display:none;">
            <h1>Manage Teachers</h1>
            <button class="btn" onclick="showTeacherForm()">+ Add New Teacher</button>

            <div id="teacher-form" class="form-section" style="display:none;">
                <h3>Add New Teacher</h3>
                <form id="add-teacher-form" class="admin-form">
                    <div class="form-group">
                        <label for="teacher-name">Full Name <span class="required">*</span></label>
                        <input type="text" id="teacher-name" placeholder="Enter teacher's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-email">Email (Login) <span class="required">*</span></label>
                        <input type="email" id="teacher-email" placeholder="teacher@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-subject">Subject(s)</label>
                        <input type="text" id="teacher-subject" placeholder="e.g., Mathematics, English">
                    </div>
                    <div class="form-group">
                        <label for="teacher-password">Temporary Password <span class="required">*</span></label>
                        <input type="password" id="teacher-password" placeholder="Temporary login password" required minlength="6">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn">Save Teacher</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelTeacherForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Subject</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="teachers-table">
                        <tr>
                            <td colspan="4" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

       <!-- Pupils Section -->
<div id="pupils" class="admin-card" style="display:none;">
    <h1>Manage Pupils</h1>
    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; margin-bottom: var(--space-lg);">
        <button class="btn" onclick="showPupilForm()">+ Add / Edit Pupil</button>
        <button class="btn btn-success" onclick="exportPupilsToExcel()">üìä Export to Excel</button>
        <button class="btn btn-primary" onclick="exportPupilsToPDF()">üìÑ Export to PDF</button>
    </div>

    <div id="pupil-form" class="form-section" style="display:none;">
        <h3 id="pupil-form-title">Add / Edit Pupil</h3>
        <form id="add-pupil-form" class="admin-form">
            <input type="hidden" id="pupil-id">

            <div class="form-group">
                <label for="pupil-name">Full Name <span class="required">*</span></label>
                <input type="text" id="pupil-name" placeholder="Enter pupil's full name" required>
            </div>

            <div class="form-group">
                <label for="pupil-admission-no">Admission No <span class="required">*</span></label>
                <input type="text" id="pupil-admission-no" placeholder="Enter admission number" required>
            </div>

            <div class="form-group">
                <label for="pupil-dob">Date of Birth <span class="required">*</span></label>
                <input type="date" id="pupil-dob" required>
            </div>

            <div class="form-group">
                <label for="pupil-gender">Gender <span class="required">*</span></label>
                <select id="pupil-gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pupil-class">Class <span class="required">*</span></label>
                <select id="pupil-class" required>
                    <option value="">-- Select Class --</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pupil-parent-name">Parent / Guardian Name</label>
                <input type="text" id="pupil-parent-name" placeholder="Parent / Guardian Name">
            </div>

            <div class="form-group">
                <label for="pupil-parent-email">Parent Email</label>
                <input type="email" id="pupil-parent-email" placeholder="parent@example.com">
            </div>

            <div class="form-group">
                <label for="pupil-contact">Contact Number</label>
                <input type="tel" id="pupil-contact" placeholder="e.g., +2348012345678">
            </div>

            <div class="form-group">
                <label for="pupil-address">Address</label>
                <textarea id="pupil-address" rows="3" placeholder="Home address"></textarea>
            </div>

            <div class="form-group">
                <label for="pupil-email">Pupil Email (Login) <span class="required">*</span></label>
                <input type="email" id="pupil-email" placeholder="pupil@example.com" required>
            </div>

            <div class="form-group">
                <label for="pupil-password">Temporary Password <span class="required">*</span></label>
                <input type="password" id="pupil-password" placeholder="Temporary login password" required minlength="6">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn" id="save-pupil-btn">Save Pupil</button>
                <button type="button" class="btn btn-secondary" onclick="cancelPupilForm()">Cancel</button>
            </div>
        </form>
    </div>

 <!-- BULK ACTIONS BAR -->
<div id="bulk-actions-bar" style="display:none; background:#f8f9fa; padding:var(--space-md); border-radius:var(--radius-md); margin-bottom:var(--space-lg); align-items:center; gap:var(--space-md);">
  <input type="checkbox" id="select-all-pupils" onchange="toggleAllPupils(this)" style="cursor:pointer;">
  <label for="select-all-pupils" style="cursor:pointer; margin:0;">Select All</label>
  
  <span id="selected-count" style="margin-left:var(--space-md); color:var(--color-gray-600); font-size:var(--text-sm);">
    0 selected
  </span>
  
  <div style="margin-left:auto; display:flex; gap:var(--space-sm);">
    <select id="bulk-action-select" disabled style="padding:var(--space-xs) var(--space-sm);">
      <option value="">-- Select Action --</option>
      <option value="reassign-class">Reassign to Class</option>
      <option value="delete">Delete Selected</option>
    </select>
    
    <button id="apply-bulk-action-btn" class="btn-small btn-primary" onclick="applyBulkAction()" disabled>
      Apply to Selected
    </button>
  </div>
</div>


    <div class="table-container">
        <table class="responsive-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Gender</th>
                    <th>Parent Name</th>
                    <th>Parent Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="pupils-table">
                <tr>
                    <td colspan="6" class="table-loading">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Alumni Section (NEW) -->
<div id="alumni" class="admin-card" style="display:none;">
    <h1>Alumni (Graduated Pupils)</h1>
    <p class="section-description">Pupils who have graduated from the terminal class</p>

    <div class="table-container">
        <table class="responsive-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Final Class</th>
                    <th>Graduation Session</th>
                    <th>Graduation Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="alumni-table">
                <tr>
                    <td colspan="5" class="table-loading">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- AUDIT LOG SECTION -->
<div id="audit-log" class="admin-card" style="display:none;">
  <h2>üìã Audit Log</h2>
  <p style="color:var(--color-gray-600); margin-bottom:var(--space-lg);">
    View system activity and administrative actions. All critical operations are logged for compliance and security.
  </p>
  
  <div id="audit-log-container"></div>
</div>

<!-- View Results Section (NEW) -->
<div id="view-results" class="admin-card" style="display:none;">
    <h1>View Pupil Results</h1>
    <p class="section-description">Search and view academic results by session, class, and pupil</p>

    <!-- Filter Controls -->
    <div class="form-section" style="background: #f8fafc; padding: var(--space-xl); border-radius: var(--radius-lg); margin-bottom: var(--space-xl);">
        <h3 style="margin-top: 0; margin-bottom: var(--space-lg); color: var(--color-primary);">
            üîç Filter Results
        </h3>
        
        <div class="form-row form-row-3">
            <div class="form-group">
                <label for="filter-session">
                    <strong>1. Select Session</strong> <span class="required">*</span>
                </label>
                <select id="filter-session" onchange="loadFilteredClasses()">
                    <option value="">-- Select Session --</option>
                    <option value="current">Current Session</option>
                </select>
                <small style="color: var(--color-gray-600); display: block; margin-top: var(--space-xs);">
                    Choose academic session to view
                </small>
            </div>
            
            <div class="form-group">
                <label for="filter-class">
                    <strong>2. Select Class</strong> <span class="required">*</span>
                </label>
                <select id="filter-class" onchange="loadFilteredPupils()" disabled>
                    <option value="">-- Select Class --</option>
                </select>
                <small style="color: var(--color-gray-600); display: block; margin-top: var(--space-xs);">
                    Filter by class
                </small>
            </div>
            
            <div class="form-group">
                <label for="filter-pupil">
                    <strong>3. Select Pupil</strong> <span class="required">*</span>
                </label>
                <select id="filter-pupil" onchange="loadPupilResults()" disabled>
                    <option value="">-- Select Pupil --</option>
                </select>
                <small style="color: var(--color-gray-600); display: block; margin-top: var(--space-xs);">
                    View individual results
                </small>
            </div>
        </div>
        
        <div style="display: flex; gap: var(--space-md); margin-top: var(--space-lg); flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="clearResultsFilter()">
                üîÑ Clear Filters
            </button>
            <button class="btn" onclick="loadPupilResults()" id="view-results-btn" disabled>
                üëÅÔ∏è View Results
            </button>
        </div>
    </div>

    <!-- Pupil Info Card -->
    <div id="pupil-info-card" class="form-section" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: var(--space-xl);">
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: var(--space-lg);">
            <div style="flex: 1; min-width: 250px;">
                <h3 style="margin: 0 0 var(--space-sm); color: white;">
                    <span id="pupil-info-name">Pupil Name</span>
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                    <div>
                        <div style="font-size: var(--text-xs); opacity: 0.9; text-transform: uppercase; letter-spacing: 0.05em;">Class</div>
                        <div style="font-size: var(--text-lg); font-weight: 700; margin-top: var(--space-xs);" id="pupil-info-class">-</div>
                    </div>
                    <div>
                        <div style="font-size: var(--text-xs); opacity: 0.9; text-transform: uppercase; letter-spacing: 0.05em;">Session</div>
                        <div style="font-size: var(--text-lg); font-weight: 700; margin-top: var(--space-xs);" id="pupil-info-session">-</div>
                    </div>
                    <div>
                        <div style="font-size: var(--text-xs); opacity: 0.9; text-transform: uppercase; letter-spacing: 0.05em;">Gender</div>
                        <div style="font-size: var(--text-lg); font-weight: 700; margin-top: var(--space-xs);" id="pupil-info-gender">-</div>
                    </div>
                </div>
            </div>
            <div>
                <button class="btn" onclick="exportPupilResults()" style="background: rgba(255,255,255,0.2); border: 2px solid white;">
                    üì• Export Results
                </button>
            </div>
        </div>
    </div>

    <!-- Results Display -->
    <div id="results-display-container">
        <div style="text-align: center; padding: var(--space-2xl); color: var(--color-gray-600);">
            <div style="font-size: 3rem; margin-bottom: var(--space-md);">üìä</div>
            <p style="font-size: var(--text-lg); font-weight: 600; margin-bottom: var(--space-xs);">
                Select filters to view results
            </p>
            <p style="font-size: var(--text-sm);">
                Choose session, class, and pupil from the filters above
            </p>
        </div>
    </div>

    <!-- Session Comparison -->
    <div id="session-comparison-section" style="display: none; margin-top: var(--space-2xl); padding-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
            <div>
                <h2 style="margin: 0;">üìà Session Comparison</h2>
                <p style="color: var(--color-gray-600); margin: var(--space-xs) 0 0;">
                    Compare this pupil's performance across different sessions
                </p>
            </div>
            <button class="btn btn-secondary" onclick="toggleSessionComparison()">
                Hide Comparison
            </button>
        </div>
        <div id="session-comparison-content">
            <!-- Comparison data will be loaded here -->
        </div>
    </div>
</div>

       <!-- Classes Section -->
        <div id="classes" class="admin-card" style="display:none;">
            <h1>Manage Classes</h1>
            <button class="btn" onclick="showClassForm()">+ Add New Class</button>

            <div id="class-form" class="form-section" style="display:none;">
                <h3>Create New Class</h3>
                <div class="form-group">
                    <label for="class-name">Class Name <span class="required">*</span></label>
                    <input type="text" id="class-name" placeholder="e.g., Nursery 1, Primary 3" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="addClass()">Create Class</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('class-form').style.display='none'">Cancel</button>
                </div>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Class Name</th>
                            <th>Pupil Count</th>
                            <th>Assigned Subjects</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="classes-table">
                        <tr>
                            <td colspan="4" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- NEW: Subject Assignment Modal -->
            <div id="subject-assignment-modal" class="modal" style="display:none;">
                <div class="modal-content" style="max-width: 600px;">
                    <button class="modal-close" onclick="closeSubjectAssignmentModal()" aria-label="Close subject assignment modal">&times;</button>
                    <h2>Assign Subjects to Class</h2>
                    <p id="assignment-class-name" style="font-weight:600; margin-bottom: var(--space-lg);"></p>

                    <div id="subject-checkboxes" class="subject-checkbox-container">
                        <!-- Checkboxes will be loaded here -->
                    </div>

                    <div class="form-actions" style="margin-top: var(--space-xl);">
                        <button class="btn" onclick="saveClassSubjects()">
                            üíæ Save Subjects
                        </button>
                        <button class="btn btn-secondary" onclick="closeSubjectAssignmentModal()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects Section -->
        <div id="subjects" class="admin-card" style="display:none;">
            <h1>Manage Subjects</h1>
            <button class="btn" onclick="showSubjectForm()">+ Add New Subject</button>

            <div id="subject-form" class="form-section" style="display:none;">
                <h3>Create New Subject</h3>
                <div class="form-group">
                    <label for="subject-name">Subject Name <span class="required">*</span></label>
                    <input type="text" id="subject-name" placeholder="e.g., Mathematics, English" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="addSubject()">Create Subject</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('subject-form').style.display='none'">Cancel</button>
                </div>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Subject Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subjects-table">
                        <tr>
                            <td colspan="2" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Assign Teachers Section (NEW) -->
        <div id="assign-teachers" class="admin-card" style="display:none;">
            <h1>Assign Teachers to Classes</h1>
            <p class="section-description">Select a teacher and class to make an assignment. Teachers can be assigned to multiple classes if needed.</p>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="assign-teacher">Select Teacher <span class="required">*</span></label>
                    <select id="assign-teacher" required>
                        <option value="">-- Select Teacher --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assign-class">Select Class <span class="required">*</span></label>
                    <select id="assign-class" required>
                        <option value="">-- Select Class --</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="assignTeacherToClass()">Assign Teacher</button>

            <h2>Current Assignments</h2>
            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Class Name</th>
                            <th>Assigned Teacher</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="assignments-table">
                        <tr>
                            <td colspan="3" class="table-loading">Loading current assignments...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

<!-- Promotion Requests Section (NEW) -->
        <div id="promotion-requests" class="admin-card" style="display:none;">
            <h1>Promotion Requests</h1>
            <p class="section-description">Review and approve teacher promotion recommendations</p>

            <!-- Promotion Period Toggle -->
            <div class="promotion-period-control">
                <div class="control-info">
                    <h3>Promotion Period Status</h3>
                    <p id="promotion-period-status">Loading...</p>
                </div>
                <div class="control-actions">
                    <button class="btn" id="toggle-promotion-period-btn" onclick="togglePromotionPeriod()">
                        Enable Promotion Period
                    </button>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulk-actions" style="display:none;">
                <button class="btn btn-success" onclick="approveAllPendingPromotions()">
                    ‚úì Approve All Pending
                </button>
                <button class="btn btn-danger" onclick="rejectAllPendingPromotions()">
                    ‚úó Reject All Pending
                </button>
            </div>

            <!-- Promotion Requests Table -->
            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Teacher</th>
                            <th>From Class</th>
                            <th>To Class</th>
                            <th>Pupils to Promote</th>
                            <th>Pupils to Hold</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="promotion-requests-table">
                        <tr>
                            <td colspan="7" class="table-loading">Loading promotion requests...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- No Requests Message -->
            <div id="no-requests-message" style="display:none; text-align:center; padding: var(--space-2xl); color: var(--color-gray-600);">
                <p style="font-size: var(--text-lg); margin-bottom: var(--space-md);">üìã No promotion requests yet</p>
                <p>Teachers will submit promotion requests when the promotion period is active.</p>
            </div>
        </div>

        <!-- Promotion Details Modal (NEW) -->
        <div id="promotion-details-modal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width: 800px;">
                <button class="modal-close" onclick="closePromotionDetailsModal()" aria-label="Close promotion details modal">&times;</button>
                <h2>Promotion Request Details</h2>
                
                <div id="promotion-details-content">
                    <!-- Details will be loaded here -->
                </div>

                <div class="modal-actions">
                    <button class="btn btn-success" id="approve-promotion-btn" onclick="approvePromotion()">
                        ‚úì Approve & Execute
                    </button>
                    <button class="btn btn-danger" id="reject-promotion-btn" onclick="rejectPromotion()">
                        ‚úó Reject Request
                    </button>
                    <button class="btn btn-secondary" onclick="closePromotionDetailsModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Result Approvals Section (NEW) -->
<div id="result-approvals" class="admin-card" style="display:none;">
    <h1>Result Approvals</h1>
    <p class="section-description">Review and approve teacher-submitted results</p>
    
    <div class="table-container">
        <table class="responsive-table">
            <thead>
                <tr>
                    <th>Teacher</th>
                    <th>Class</th>
                    <th>Subject</th>
                    <th>Term</th>
                    <th>Pupils</th>
                    <th>Submitted</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="result-approvals-table">
                <tr><td colspan="8" class="table-loading">Loading...</td></tr>
            </tbody>
        </table>
    </div>
    
    <div id="no-approvals-message" style="display:none; text-align:center; padding: var(--space-2xl); color: var(--color-gray-600);">
        <p style="font-size: var(--text-lg); margin-bottom: var(--space-md);">üìã No Pending Approvals</p>
        <p>Teachers will submit results here for your review.</p>
    </div>
</div>

        <!-- ========================================
     FEE MANAGEMENT SECTION
========================================= -->
<section id="fee-management" class="admin-card" style="display:none;">
  <h1>üí∞ Fee Management</h1>
  <p class="section-description">Configure fee structures for each class and term</p>
  
  <!-- Current Session/Term Display -->
  <div class="alert alert-info" style="margin-bottom:var(--space-xl);">
    <strong>Current Session:</strong> <span id="fee-session-display">Loading...</span> ‚Ä¢ 
    <strong>Term:</strong> <span id="fee-term-display">Loading...</span>
  </div>
  
  <!-- Fee Configuration Form -->
  <div class="admin-card" style="background:var(--color-gray-50); border:2px solid var(--color-primary);">
    <h2 style="margin-top:0;">Configure Fee Structure</h2>
    
    <div class="form-row">
      <div class="form-group">
        <label for="fee-config-class">Select Class <span style="color:var(--color-danger);">*</span></label>
        <select id="fee-config-class" required>
          <option value="">-- Select Class --</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="fee-tuition">Tuition Fee (‚Ç¶)</label>
        <input type="number" id="fee-tuition" min="0" step="0.01" placeholder="0.00">
      </div>
      
      <div class="form-group">
        <label for="fee-exam">Exam Fee (‚Ç¶)</label>
        <input type="number" id="fee-exam" min="0" step="0.01" placeholder="0.00">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="fee-uniform">Uniform Fee (‚Ç¶)</label>
        <input type="number" id="fee-uniform" min="0" step="0.01" placeholder="0.00">
      </div>
      
      <div class="form-group">
        <label for="fee-books">Books Fee (‚Ç¶)</label>
        <input type="number" id="fee-books" min="0" step="0.01" placeholder="0.00">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="fee-pta">PTA Fee (‚Ç¶)</label>
        <input type="number" id="fee-pta" min="0" step="0.01" placeholder="0.00">
      </div>
      
      <div class="form-group">
        <label for="fee-other">Other Fees (‚Ç¶)</label>
        <input type="number" id="fee-other" min="0" step="0.01" placeholder="0.00">
      </div>
    </div>
    
    <button class="btn btn-primary" id="save-fee-structure-btn" onclick="saveFeeStructure()">
      üíæ Save Fee Structure
    </button>
  </div>
  
  <!-- Existing Fee Structures -->
  <div style="margin-top:var(--space-2xl);">
    <h2>Configured Fee Structures</h2>
    <div id="fee-structures-list">
      <div style="text-align:center; padding:var(--space-2xl);">
        <div class="spinner"></div>
        <p>Loading fee structures...</p>
      </div>
    </div>
  </div>
</section>

<!-- ========================================
     RECORD PAYMENT SECTION
========================================= -->
<section id="record-payment" class="admin-card" style="display:none;">
  <h1>üí≥ Record Payment</h1>
  <p class="section-description">Record fee payments and generate receipts</p>
  
  <!-- Current Session/Term Display -->
  <div class="alert alert-info" style="margin-bottom:var(--space-xl);">
    <strong>Session:</strong> <span id="payment-session-display">Loading...</span> ‚Ä¢ 
    <strong>Term:</strong> <span id="payment-term-display">Loading...</span>
  </div>
  
  <!-- Class and Pupil Selection -->
  <div class="form-row">
    <div class="form-group">
      <label for="payment-class-filter">Select Class <span style="color:var(--color-danger);">*</span></label>
      <select id="payment-class-filter" onchange="loadPupilsForPayment()">
        <option value="">-- Select Class --</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="payment-pupil-select">Select Pupil <span style="color:var(--color-danger);">*</span></label>
      <select id="payment-pupil-select" onchange="loadPupilPaymentStatus()">
        <option value="">-- Select Pupil --</option>
      </select>
    </div>
  </div>
  
  <!-- Payment Form Container -->
  <div id="payment-form-container" style="display:none;">
    
    <!-- Payment Status Display -->
    <div id="payment-status-display" style="margin-bottom:var(--space-xl);">
      <!-- Populated by JavaScript -->
    </div>
    
    <!-- Payment Input Section -->
    <div id="payment-input-section" class="admin-card" style="background:var(--color-gray-50); border:2px solid var(--color-success); display:none;">
      <h2 style="margin-top:0;">Record New Payment</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="payment-amount">Amount Paid (‚Ç¶) <span style="color:var(--color-danger);">*</span></label>
          <input type="number" id="payment-amount" min="0" step="0.01" placeholder="0.00" required>
          <small style="color:var(--color-gray-600);">Enter the amount paid by the parent</small>
        </div>
        
        <div class="form-group">
          <label for="payment-method">Payment Method</label>
          <select id="payment-method">
            <option value="cash">Cash</option>
            <option value="bank">Bank Transfer</option>
            <option value="pos">POS/Card</option>
            <option value="online">Online Payment</option>
            <option value="cheque">Cheque</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="payment-notes">Notes (Optional)</label>
        <textarea id="payment-notes" rows="2" placeholder="Add any additional notes about this payment..."></textarea>
      </div>
      
      <button class="btn btn-primary" id="record-payment-btn" onclick="recordPayment()">
        üí∞ Record Payment
      </button>
    </div>
    
    <!-- Payment History -->
    <div style="margin-top:var(--space-2xl);">
      <h3>Payment History</h3>
      <div id="payment-history-list">
        <!-- Populated by JavaScript -->
      </div>
    </div>
  </div>
</section>

<!-- ========================================
     OUTSTANDING FEES SECTION
========================================= -->
<section id="outstanding-fees" class="admin-card" style="display:none;">
  <h1>üìä Outstanding Fees</h1>
  <p class="section-description">Track pupils with outstanding fee balances</p>
  
  <!-- Summary Cards -->
  <div class="stats-grid" style="margin-bottom:var(--space-2xl);">
    <div class="stat-card" style="background:linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
      <div class="stat-icon">üìã</div>
      <div class="stat-value" id="outstanding-count">0</div>
      <div class="stat-label">Pupils Owing</div>
    </div>
    
    <div class="stat-card" style="background:linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
      <div class="stat-icon">üí∞</div>
      <div class="stat-value" id="outstanding-total">‚Ç¶0</div>
      <div class="stat-label">Total Outstanding</div>
    </div>
  </div>
  
  <!-- Outstanding Fees Table -->
  <div class="table-container">
    <table class="responsive-table" id="outstanding-fees-table">
      <thead>
        <tr>
          <th>Pupil Name</th>
          <th>Class</th>
          <th>Amount Due</th>
          <th>Paid</th>
          <th>Balance</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="6" class="table-loading">Loading outstanding fees...</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- ========================================
     FINANCIAL REPORTS SECTION
========================================= -->
<section id="financial-reports" class="admin-card" style="display:none;">
  <h1>üìà Financial Reports</h1>
  <p class="section-description">Comprehensive financial overview and analytics</p>
  
  <!-- Session/Term Display -->
  <div class="alert alert-info" style="margin-bottom:var(--space-xl);">
    <strong>Reporting Period:</strong> 
    <span id="report-session-display">Loading...</span> ‚Ä¢ 
    <span id="report-term-display">Loading...</span>
  </div>
  
  <!-- Summary Statistics -->
  <div class="stats-grid">
    <div class="stat-card" style="background:linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
      <div class="stat-icon">üíµ</div>
      <div class="stat-value" id="report-total-expected">‚Ç¶0</div>
      <div class="stat-label">Total Expected</div>
    </div>
    
    <div class="stat-card" style="background:linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);">
      <div class="stat-icon">‚úì</div>
      <div class="stat-value" id="report-total-collected">‚Ç¶0</div>
      <div class="stat-label">Total Collected</div>
    </div>
    
    <div class="stat-card" style="background:linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-value" id="report-total-outstanding">‚Ç¶0</div>
      <div class="stat-label">Outstanding</div>
    </div>
    
    <div class="stat-card" style="background:linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">
      <div class="stat-icon">üìä</div>
      <div class="stat-value" id="report-collection-rate">0%</div>
      <div class="stat-label">Collection Rate</div>
    </div>
  </div>
  
  <!-- Payment Status Breakdown -->
  <div class="admin-card" style="margin-top:var(--space-2xl); background:var(--color-gray-50);">
    <h2 style="margin-top:0;">Payment Status Breakdown</h2>
    
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:var(--space-lg);">
      <div style="text-align:center; padding:var(--space-xl); background:white; border-radius:var(--radius-md); border:2px solid var(--color-success);">
        <div style="font-size:3rem; margin-bottom:var(--space-sm);">‚úì</div>
        <div style="font-size:2rem; font-weight:700; color:var(--color-success);" id="report-paid-full">0</div>
        <div style="color:var(--color-gray-600); margin-top:var(--space-xs);">Paid in Full</div>
      </div>
      
      <div style="text-align:center; padding:var(--space-xl); background:white; border-radius:var(--radius-md); border:2px solid var(--color-warning);">
        <div style="font-size:3rem; margin-bottom:var(--space-sm);">‚ö†Ô∏è</div>
        <div style="font-size:2rem; font-weight:700; color:var(--color-warning);" id="report-partial">0</div>
        <div style="color:var(--color-gray-600); margin-top:var(--space-xs);">Partial Payment</div>
      </div>
      
      <div style="text-align:center; padding:var(--space-xl); background:white; border-radius:var(--radius-md); border:2px solid var(--color-danger);">
        <div style="font-size:3rem; margin-bottom:var(--space-sm);">‚úó</div>
        <div style="font-size:2rem; font-weight:700; color:var(--color-danger);" id="report-owing">0</div>
        <div style="color:var(--color-gray-600); margin-top:var(--space-xs);">Not Paid</div>
      </div>
    </div>
  </div>
  
  <!-- Export Options -->
  <div style="margin-top:var(--space-2xl); padding:var(--space-xl); background:white; border:1px solid var(--color-gray-300); border-radius:var(--radius-md);">
    <h3 style="margin-top:0;">Export Reports</h3>
    <p style="color:var(--color-gray-600); margin-bottom:var(--space-lg);">Download financial data for external analysis</p>
    
    <div style="display:flex; gap:var(--space-md); flex-wrap:wrap;">
      <button class="btn btn-secondary" onclick="exportFinancialReport('csv')">
        üì• Export to CSV
      </button>
      <button class="btn btn-secondary" onclick="exportFinancialReport('pdf')">
        üìÑ Generate PDF Report
      </button>
    </div>
  </div>
</section>

        <!-- Announcements Section -->
        <div id="announcements" class="admin-card" style="display:none;">
            <h1>Manage Announcements</h1>
            <button class="btn" onclick="showAnnounceForm()">+ New Announcement</button>

            <div id="announce-form" class="form-section" style="display:none;">
                <h3>Create Announcement</h3>
                <form id="add-announcement-form" class="admin-form">
                    <div class="form-group">
                        <label for="announce-title">Title <span class="required">*</span></label>
                        <input type="text" id="announce-title" placeholder="Announcement title" required>
                    </div>
                    <div class="form-group">
                        <label for="announce-content">Content <span class="required">*</span></label>
                        <textarea id="announce-content" rows="6" placeholder="Write your announcement here..." required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="addAnnouncement()">Publish</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('announce-form').style.display='none'">Cancel</button>
                    </div>
                </form>
            </div>

            <div id="announcements-list" class="announcements-list">
                <div class="skeleton-container">
                    <div class="skeleton"></div>
                </div>
            </div>
        </div>
        
       <!-- School Settings Section -->
<div id="settings" class="admin-card" style="display:none;">
    <h1>School Settings</h1>
    <p class="section-description">Manage academic session, term, and system settings</p>

    <!-- Session Status Card -->
    <div class="session-status-card" id="session-status-card">
        <div class="status-header">
            <h3>üìÖ Current Academic Session</h3>
            <span class="status-badge" id="session-status-badge">Active</span>
        </div>
        <div class="status-body">
            <div class="status-item">
                <span class="status-label">Session:</span>
                <span class="status-value" id="display-session-name">Loading...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Current Term:</span>
                <span class="status-value" id="display-current-term">Loading...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Session Starts:</span>
                <span class="status-value" id="display-session-start">Loading...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Session Ends:</span>
                <span class="status-value" id="display-session-end">Loading...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Next Resumption:</span>
                <span class="status-value" id="display-next-resumption">Loading...</span>
            </div>
        </div>
        <div class="status-alert" id="session-end-alert" style="display:none;">
            <strong>‚ö†Ô∏è Session Ending Soon!</strong>
            <p>This academic session will end soon. Prepare for promotion and new session.</p>
        </div>
    </div>

    <!-- Edit Session Form -->
    <div class="form-section" style="margin-top: var(--space-xl);">
        <h3>üìù Update Session Settings</h3>
        <form id="settings-form" class="admin-form">
            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="session-start-year">Session Start Year <span class="required">*</span></label>
                    <input type="number" id="session-start-year" placeholder="2025" required min="2020" max="2100">
                </div>
                <div class="form-group">
                    <label for="session-end-year">Session End Year <span class="required">*</span></label>
                    <input type="number" id="session-end-year" placeholder="2026" required min="2020" max="2100">
                </div>
            </div>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="session-start-date">Session Start Date <span class="required">*</span></label>
                    <input type="date" id="session-start-date" required>
                </div>
                <div class="form-group">
                    <label for="session-end-date">Session End Date <span class="required">*</span></label>
                    <input type="date" id="session-end-date" required>
                </div>
            </div>

            <div class="form-group">
                <label for="current-term">Current Term <span class="required">*</span></label>
                <select id="current-term" required>
                    <option value="First Term">First Term</option>
                    <option value="Second Term">Second Term</option>
                    <option value="Third Term">Third Term</option>
                </select>
            </div>

            <div class="form-group">
                <label for="resumption-date">Next Resumption Date <span class="required">*</span></label>
                <input type="date" id="resumption-date" required>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn">üíæ Save Settings</button>
                <button type="button" class="btn btn-secondary" onclick="loadCurrentSettings()">‚Üª Refresh</button>
            </div>
        </form>
    </div>

    <!-- Start New Session Section -->
    <div class="form-section" style="margin-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300); padding-top: var(--space-xl);">
        <h3 style="color: var(--color-primary);">üéì Start New Academic Session</h3>
        <p style="color: var(--color-gray-700); margin-bottom: var(--space-lg);">
            Use this when the current session ends. This will archive the current session and create a new one.
        </p>
        
        <div class="alert alert-warning" style="margin-bottom: var(--space-lg);">
            <strong>‚ö†Ô∏è Important:</strong> Starting a new session will:
            <ul style="margin: var(--space-sm) 0 0 var(--space-lg);">
                <li>Archive the current session</li>
                <li>Create a new session (next year)</li>
                <li>Reset current term to "First Term"</li>
                <li>Enable promotion period for teachers</li>
            </ul>
        </div>

        <button type="button" class="btn btn-danger" onclick="confirmStartNewSession()" id="start-new-session-btn">
            üöÄ Start New Session
        </button>
    </div>

    <!-- Session History -->
    <div class="form-section" style="margin-top: var(--space-2xl);">
        <h3>üìö Session History</h3>
        <div id="session-history-container" class="table-container">
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>Session</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="session-history-table">
                    <tr>
                        <td colspan="4" class="table-loading">Loading history...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Data Migration Section -->
<div class="form-section" style="margin-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300); padding-top: var(--space-xl);">
    <h3 style="color: #f59e0b;">‚öôÔ∏è Data Migration Tools</h3>
    <p style="color: var(--color-gray-700); margin-bottom: var(--space-lg);">
        <strong>One-time operation:</strong> Update existing results to include session information.
    </p>
    
    <div class="alert alert-warning" style="margin-bottom: var(--space-lg);">
        <strong>‚ö†Ô∏è Important Instructions:</strong>
        <ul style="margin: var(--space-sm) 0 0 var(--space-lg); line-height: 1.8;">
            <li>This operation will add session context to all existing results that don't have it</li>
            <li>All existing results will be assigned to the <strong>current session</strong></li>
            <li>This is safe and will NOT delete or overwrite any existing data</li>
            <li>The operation may take a few minutes if you have many results</li>
            <li>Only run this ONCE when you first enable the session system</li>
        </ul>
    </div>
    
    <div style="display: flex; gap: var(--space-md); align-items: center; flex-wrap: wrap;">
        <button type="button" class="btn btn-warning" onclick="backfillSessionData()" id="backfill-btn">
            üîÑ Migrate Existing Results
        </button>
        <div id="migration-status" style="flex: 1; min-width: 300px; padding: var(--space-md); background: white; border-radius: var(--radius-sm); display: none;">
            <p style="margin: 0; font-size: 0.875rem;"></p>
        </div>
    </div>
</div>
    </div>

    <!-- Class Hierarchy Management -->
    <div class="form-section" style="margin-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300); padding-top: var(--space-xl);">
        <h3>üìä Class Progression Order</h3>
        <p style="color: var(--color-gray-700); margin-bottom: var(--space-lg);">
            Arrange your classes in order from lowest to highest level. The last class in the list will be the terminal/graduation class.
        </p>

        <div class="alert alert-info" style="margin-bottom: var(--space-lg);">
            <strong>‚ÑπÔ∏è How it works:</strong>
            <ul style="margin: var(--space-sm) 0 0 var(--space-lg);">
                <li><strong>Classes are automatically loaded from the "Classes" section</strong></li>
                <li>Drag and drop to rearrange the order</li>
                <li>The last class (bottom) will be the terminal/graduation class</li>
                <li>Pupils in the terminal class will graduate and move to alumni</li>
                <li>To add/remove classes, go to the "Classes" section above</li>
            </ul>
        </div>

        <div class="class-hierarchy-editor">
            <!-- This single container will hold ALL classes -->
            <div id="hierarchy-container">
                <!-- Classes will be loaded here dynamically -->
            </div>
        </div>
    </div>
</div>
</div> <!-- Close content-wrapper -->
    </main>

    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- School Scripts -->
    <script src="firebase-init.js"></script>
    <script src="class-hierarchy.js"></script>
    <script src="pupils-export.js"></script>
    <script src="admin.js"></script>
    <script src="script.js"></script>
    <!-- Optimization Scripts -->
<script src="session-cache.js"></script>
<script src="button-loader.js"></script>

<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('‚úì Service Worker registered'))
      .catch(err => console.log('Service Worker registration failed:', err));
  });
}
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Fahmid Nursery & Primary School</title>
    <link rel="stylesheet" href="styles.css">
        <style>
        /* Modal Styles for Subject Assignment */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: var(--space-2xl);
            border-radius: var(--radius-lg);
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-close {
            position: absolute;
            right: var(--space-lg);
            top: var(--space-lg);
            font-size: 28px;
            font-weight: bold;
            color: var(--color-gray-600);
            cursor: pointer;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--color-danger);
        }

        .subject-checkbox-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
            max-height: 400px;
            overflow-y: auto;
            padding: var(--space-md);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background: var(--color-gray-50);
        }

        .subject-checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: white;
            border-radius: var(--radius-sm);
            transition: background 0.2s;
        }

        .subject-checkbox-item:hover {
            background: var(--color-gray-100);
        }

        .subject-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .subject-checkbox-item label {
            cursor: pointer;
            margin: 0;
            font-size: var(--text-sm);
            user-select: none;
        }
        
        /* Session Status Card Styles */
        .session-status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            color: white;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            margin-bottom: var(--space-xl);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .status-header h3 {
            margin: 0;
            font-size: var(--text-xl);
            color: white;
        }

        .status-badge {
            padding: var(--space-xs) var(--space-md);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: var(--text-sm);
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .status-badge.ending-soon {
            background: #ff9800;
            color: white;
        }

        .status-badge.ended {
            background: #f44336;
            color: white;
        }

        .status-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .status-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .status-label {
            font-size: var(--text-xs);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-value {
            font-size: var(--text-lg);
            font-weight: 700;
        }

        .status-alert {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid rgba(255, 152, 0, 0.5);
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
        }

        .status-alert strong {
            display: block;
            margin-bottom: var(--space-xs);
        }

        .status-alert p {
            margin: 0;
            font-size: var(--text-sm);
        }

        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin: var(--space-md) 0;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }

        .alert ul {
            margin: var(--space-sm) 0 0 var(--space-lg);
            padding: 0;
        }

        .alert li {
            margin-bottom: var(--space-xs);
        }
        /* Class Hierarchy Editor Styles */
        .class-hierarchy-editor {
            background: var(--color-gray-50);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-gray-300);
        }

        .hierarchy-section {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .hierarchy-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .hierarchy-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm);
            background: var(--color-gray-50);
            border-radius: var(--radius-sm);
            transition: background 0.2s;
        }

        .hierarchy-item:hover {
            background: var(--color-gray-100);
        }

        .hierarchy-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            font-size: var(--text-sm);
            flex-shrink: 0;
        }

        .hierarchy-input {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-sm);
            font-size: var(--text-base);
            transition: border-color 0.2s;
        }

        .hierarchy-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn-icon {
            padding: var(--space-xs);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .btn-icon.btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-icon.btn-danger:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            color: #0d47a1;
        }
        /* Promotion Period Control */
        .promotion-period-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            background: var(--color-gray-50);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            gap: var(--space-lg);
            flex-wrap: wrap;
        }

        .control-info h3 {
            margin: 0 0 var(--space-xs);
            font-size: var(--text-lg);
            color: var(--color-gray-900);
        }

        .control-info p {
            margin: 0;
            font-size: var(--text-sm);
            color: var(--color-gray-600);
        }

        .control-info p.status-active {
            color: var(--color-success);
            font-weight: 600;
        }

        .control-info p.status-inactive {
            color: var(--color-danger);
            font-weight: 600;
        }

        .control-actions {
            display: flex;
            gap: var(--space-md);
        }

        /* Bulk Actions */
        .bulk-actions {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--color-gray-50);
            border-radius: var(--radius-md);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* Status Badges */
        .status-pending {
            background: #ff9800;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-approved {
            background: #4CAF50;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-rejected {
            background: #f44336;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #2196F3;
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Modal Actions */
        .modal-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-gray-300);
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Promotion Details */
        .promotion-details-section {
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--color-gray-50);
            border-radius: var(--radius-md);
        }

        .promotion-details-section h3 {
            margin: 0 0 var(--space-md);
            font-size: var(--text-base);
            color: var(--color-gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pupil-list {
            display: grid;
            gap: var(--space-xs);
        }

        .pupil-list-item {
            padding: var(--space-sm);
            background: white;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .pupil-list-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Override Options */
        .override-section {
            padding: var(--space-lg);
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: var(--radius-md);
            margin-top: var(--space-lg);
        }

        .override-section h3 {
            margin: 0 0 var(--space-md);
            color: #856404;
        }

        .override-controls {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .override-controls .form-group {
            flex: 1;
            min-width: 200px;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <button class="hamburger hamburger-portal" id="hamburger" aria-label="Toggle admin menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <nav class="admin-sidebar" id="admin-sidebar" aria-label="Admin navigation">
        <h2>Admin Panel</h2>
        <a href="#dashboard" class="active" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#teachers" onclick="showSection('teachers')">Teachers</a>
        <a href="#pupils" onclick="showSection('pupils')">Pupils</a>
        <a href="#classes" onclick="showSection('classes')">Classes</a>
        <a href="#subjects" onclick="showSection('subjects')">Subjects</a>
        <a href="#assign-teachers" onclick="showSection('assign-teachers')">Assign Teachers</a>
        <a href="#promotion-requests" onclick="showSection('promotion-requests')">Promotion Requests</a>
        <a href="#settings" onclick="showSection('settings')">School Settings</a>
        <a href="#announcements" onclick="showSection('announcements')">Announcements</a>
        <hr class="sidebar-divider">
        <a href="index.html">‚Üê Back to Public Site</a>
        <a href="#" id="admin-logout" class="logout-link">Logout</a>
    </nav>

    <main class="admin-main" id="main-content">
        <!-- Portal Header -->
<header class="portal-header">
    <div class="header-content-admin">
        <div class="header-welcome">
            <div class="welcome-text">
                <h1>Admin Dashboard</h1>
                <p>Manage your school efficiently</p>
            </div>
        </div>
        <div class="header-stats">
            <div class="stat-box">
                <div class="stat-label">Total Teachers</div>
                <div class="stat-value" id="header-teacher-count">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Pupils</div>
                <div class="stat-value" id="header-pupil-count">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Classes</div>
                <div class="stat-value" id="header-class-count">0</div>
            </div>
        </div>
    </div>
</header>

<!-- Content Wrapper -->
<div class="content-wrapper">
        <div id="dashboard" class="admin-card">
            <h1>Admin Dashboard</h1>
            <p class="section-description">Welcome to the school management system</p>
            <div class="stats-grid">
                <div class="stat-card stat-card-primary">
                    <h3>Total Teachers</h3>
                    <div class="stat-number" id="teacher-count">0</div>
                </div>
                <div class="stat-card stat-card-secondary">
                    <h3>Total Pupils</h3>
                    <div class="stat-number" id="pupil-count">0</div>
                </div>
                <div class="stat-card stat-card-success">
                    <h3>Total Classes</h3>
                    <div class="stat-number" id="class-count">0</div>
                </div>
                <div class="stat-card stat-card-warning">
                    <h3>Announcements</h3>
                    <div class="stat-number" id="announce-count">0</div>
                </div>
            </div>
        </div>

        <!-- Teachers Section -->
        <div id="teachers" class="admin-card" style="display:none;">
            <h1>Manage Teachers</h1>
            <button class="btn" onclick="showTeacherForm()">+ Add New Teacher</button>

            <div id="teacher-form" class="form-section" style="display:none;">
                <h3>Add New Teacher</h3>
                <form id="add-teacher-form" class="admin-form">
                    <div class="form-group">
                        <label for="teacher-name">Full Name <span class="required">*</span></label>
                        <input type="text" id="teacher-name" placeholder="Enter teacher's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-email">Email (Login) <span class="required">*</span></label>
                        <input type="email" id="teacher-email" placeholder="teacher@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-subject">Subject(s)</label>
                        <input type="text" id="teacher-subject" placeholder="e.g., Mathematics, English">
                    </div>
                    <div class="form-group">
                        <label for="teacher-password">Temporary Password <span class="required">*</span></label>
                        <input type="password" id="teacher-password" placeholder="Temporary login password" required minlength="6">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn">Save Teacher</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelTeacherForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Subject</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="teachers-table">
                        <tr>
                            <td colspan="4" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

       <!-- Pupils Section -->
<div id="pupils" class="admin-card" style="display:none;">
    <h1>Manage Pupils</h1>
    <button class="btn" onclick="showPupilForm()">+ Add / Edit Pupil</button>

    <div id="pupil-form" class="form-section" style="display:none;">
        <h3 id="pupil-form-title">Add / Edit Pupil</h3>
        <form id="add-pupil-form" class="admin-form">
            <input type="hidden" id="pupil-id">

            <div class="form-group">
                <label for="pupil-name">Full Name <span class="required">*</span></label>
                <input type="text" id="pupil-name" placeholder="Enter pupil's full name" required>
            </div>

            <div class="form-group">
                <label for="pupil-dob">Date of Birth <span class="required">*</span></label>
                <input type="date" id="pupil-dob" required>
            </div>

            <div class="form-group">
                <label for="pupil-gender">Gender <span class="required">*</span></label>
                <select id="pupil-gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pupil-class">Class <span class="required">*</span></label>
                <select id="pupil-class" required>
                    <option value="">-- Select Class --</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pupil-parent-name">Parent / Guardian Name</label>
                <input type="text" id="pupil-parent-name" placeholder="Parent / Guardian Name">
            </div>

            <div class="form-group">
                <label for="pupil-parent-email">Parent Email</label>
                <input type="email" id="pupil-parent-email" placeholder="parent@example.com">
            </div>

            <div class="form-group">
                <label for="pupil-contact">Contact Number</label>
                <input type="tel" id="pupil-contact" placeholder="e.g., +2348012345678">
            </div>

            <div class="form-group">
                <label for="pupil-address">Address</label>
                <textarea id="pupil-address" rows="3" placeholder="Home address"></textarea>
            </div>

            <div class="form-group">
                <label for="pupil-email">Pupil Email (Login) <span class="required">*</span></label>
                <input type="email" id="pupil-email" placeholder="pupil@example.com" required>
            </div>

            <div class="form-group">
                <label for="pupil-password">Temporary Password <span class="required">*</span></label>
                <input type="password" id="pupil-password" placeholder="Temporary login password" required minlength="6">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn" id="save-pupil-btn">Save Pupil</button>
                <button type="button" class="btn btn-secondary" onclick="cancelPupilForm()">Cancel</button>
            </div>
        </form>
    </div>

    <div class="table-container">
        <table class="responsive-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Gender</th>
                    <th>Parent Name</th>
                    <th>Parent Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="pupils-table">
                <tr>
                    <td colspan="6" class="table-loading">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

       <!-- Classes Section -->
        <div id="classes" class="admin-card" style="display:none;">
            <h1>Manage Classes</h1>
            <button class="btn" onclick="showClassForm()">+ Add New Class</button>

            <div id="class-form" class="form-section" style="display:none;">
                <h3>Create New Class</h3>
                <div class="form-group">
                    <label for="class-name">Class Name <span class="required">*</span></label>
                    <input type="text" id="class-name" placeholder="e.g., Nursery 1, Primary 3" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="addClass()">Create Class</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('class-form').style.display='none'">Cancel</button>
                </div>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Class Name</th>
                            <th>Pupil Count</th>
                            <th>Assigned Subjects</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="classes-table">
                        <tr>
                            <td colspan="4" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- NEW: Subject Assignment Modal -->
            <div id="subject-assignment-modal" class="modal" style="display:none;">
                <div class="modal-content" style="max-width: 600px;">
                    <span class="modal-close" onclick="closeSubjectAssignmentModal()">&times;</span>
                    <h2>Assign Subjects to Class</h2>
                    <p id="assignment-class-name" style="font-weight:600; margin-bottom: var(--space-lg);"></p>

                    <div id="subject-checkboxes" class="subject-checkbox-container">
                        <!-- Checkboxes will be loaded here -->
                    </div>

                    <div class="form-actions" style="margin-top: var(--space-xl);">
                        <button class="btn" onclick="saveClassSubjects()">
                            üíæ Save Subjects
                        </button>
                        <button class="btn btn-secondary" onclick="closeSubjectAssignmentModal()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects Section -->
        <div id="subjects" class="admin-card" style="display:none;">
            <h1>Manage Subjects</h1>
            <button class="btn" onclick="showSubjectForm()">+ Add New Subject</button>

            <div id="subject-form" class="form-section" style="display:none;">
                <h3>Create New Subject</h3>
                <div class="form-group">
                    <label for="subject-name">Subject Name <span class="required">*</span></label>
                    <input type="text" id="subject-name" placeholder="e.g., Mathematics, English" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="addSubject()">Create Subject</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('subject-form').style.display='none'">Cancel</button>
                </div>
            </div>

            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Subject Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subjects-table">
                        <tr>
                            <td colspan="2" class="table-loading">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Assign Teachers Section (NEW) -->
        <div id="assign-teachers" class="admin-card" style="display:none;">
            <h1>Assign Teachers to Classes</h1>
            <p class="section-description">Select a teacher and class to make an assignment. Teachers can be assigned to multiple classes if needed.</p>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="assign-teacher">Select Teacher <span class="required">*</span></label>
                    <select id="assign-teacher" required>
                        <option value="">-- Select Teacher --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assign-class">Select Class <span class="required">*</span></label>
                    <select id="assign-class" required>
                        <option value="">-- Select Class --</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="assignTeacherToClass()">Assign Teacher</button>

            <h2>Current Assignments</h2>
            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Class Name</th>
                            <th>Assigned Teacher</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="assignments-table">
                        <tr>
                            <td colspan="3" class="table-loading">Loading current assignments...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

<!-- Promotion Requests Section (NEW) -->
        <div id="promotion-requests" class="admin-card" style="display:none;">
            <h1>Promotion Requests</h1>
            <p class="section-description">Review and approve teacher promotion recommendations</p>

            <!-- Promotion Period Toggle -->
            <div class="promotion-period-control">
                <div class="control-info">
                    <h3>Promotion Period Status</h3>
                    <p id="promotion-period-status">Loading...</p>
                </div>
                <div class="control-actions">
                    <button class="btn" id="toggle-promotion-period-btn" onclick="togglePromotionPeriod()">
                        Enable Promotion Period
                    </button>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulk-actions" style="display:none;">
                <button class="btn btn-success" onclick="approveAllPendingPromotions()">
                    ‚úì Approve All Pending
                </button>
                <button class="btn btn-danger" onclick="rejectAllPendingPromotions()">
                    ‚úó Reject All Pending
                </button>
            </div>

            <!-- Promotion Requests Table -->
            <div class="table-container">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Teacher</th>
                            <th>From Class</th>
                            <th>To Class</th>
                            <th>Pupils to Promote</th>
                            <th>Pupils to Hold</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="promotion-requests-table">
                        <tr>
                            <td colspan="7" class="table-loading">Loading promotion requests...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- No Requests Message -->
            <div id="no-requests-message" style="display:none; text-align:center; padding: var(--space-2xl); color: var(--color-gray-600);">
                <p style="font-size: var(--text-lg); margin-bottom: var(--space-md);">üìã No promotion requests yet</p>
                <p>Teachers will submit promotion requests when the promotion period is active.</p>
            </div>
        </div>

        <!-- Promotion Details Modal (NEW) -->
        <div id="promotion-details-modal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width: 800px;">
                <span class="modal-close" onclick="closePromotionDetailsModal()">&times;</span>
                <h2>Promotion Request Details</h2>
                
                <div id="promotion-details-content">
                    <!-- Details will be loaded here -->
                </div>

                <div class="modal-actions">
                    <button class="btn btn-success" id="approve-promotion-btn" onclick="approvePromotion()">
                        ‚úì Approve & Execute
                    </button>
                    <button class="btn btn-danger" id="reject-promotion-btn" onclick="rejectPromotion()">
                        ‚úó Reject Request
                    </button>
                    <button class="btn btn-secondary" onclick="closePromotionDetailsModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Announcements Section -->
        <div id="announcements" class="admin-card" style="display:none;">
            <h1>Manage Announcements</h1>
            <button class="btn" onclick="showAnnounceForm()">+ New Announcement</button>

            <div id="announce-form" class="form-section" style="display:none;">
                <h3>Create Announcement</h3>
                <form id="add-announcement-form" class="admin-form">
                    <div class="form-group">
                        <label for="announce-title">Title <span class="required">*</span></label>
                        <input type="text" id="announce-title" placeholder="Announcement title" required>
                    </div>
                    <div class="form-group">
                        <label for="announce-content">Content <span class="required">*</span></label>
                        <textarea id="announce-content" rows="6" placeholder="Write your announcement here..." required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="addAnnouncement()">Publish</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('announce-form').style.display='none'">Cancel</button>
                    </div>
                </form>
            </div>

            <div id="announcements-list" class="announcements-list">
                <div class="skeleton-container">
                    <div class="skeleton"></div>
                </div>
            </div>
        </div>
        
       <!-- School Settings Section -->
        <div id="settings" class="admin-card" style="display:none;">
            <h1>School Settings</h1>
            <p class="section-description">Manage academic session, term, and system settings</p>

            <!-- Session Status Card -->
            <div class="session-status-card" id="session-status-card">
                <div class="status-header">
                    <h3>üìÖ Current Academic Session</h3>
                    <span class="status-badge" id="session-status-badge">Active</span>
                </div>
                <div class="status-body">
                    <div class="status-item">
                        <span class="status-label">Session:</span>
                        <span class="status-value" id="display-session-name">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Current Term:</span>
                        <span class="status-value" id="display-current-term">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Session Starts:</span>
                        <span class="status-value" id="display-session-start">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Session Ends:</span>
                        <span class="status-value" id="display-session-end">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Next Resumption:</span>
                        <span class="status-value" id="display-next-resumption">Loading...</span>
                    </div>
                </div>
                <div class="status-alert" id="session-end-alert" style="display:none;">
                    <strong>‚ö†Ô∏è Session Ending Soon!</strong>
                    <p>This academic session will end soon. Prepare for promotion and new session.</p>
                </div>
            </div>

            <!-- Edit Session Form -->
            <div class="form-section" style="margin-top: var(--space-xl);">
                <h3>Update Session Settings</h3>
                <form id="settings-form" class="admin-form">
                    <div class="form-row form-row-2">
                        <div class="form-group">
                            <label for="session-start-year">Session Start Year <span class="required">*</span></label>
                            <input type="number" id="session-start-year" placeholder="2025" required min="2020" max="2100">
                        </div>
                        <div class="form-group">
                            <label for="session-end-year">Session End Year <span class="required">*</span></label>
                            <input type="number" id="session-end-year" placeholder="2026" required min="2020" max="2100">
                        </div>
                    </div>

                    <div class="form-row form-row-2">
                        <div class="form-group">
                            <label for="session-start-date">Session Start Date <span class="required">*</span></label>
                            <input type="date" id="session-start-date" required>
                        </div>
                        <div class="form-group">
                            <label for="session-end-date">Session End Date <span class="required">*</span></label>
                            <input type="date" id="session-end-date" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="current-term">Current Term <span class="required">*</span></label>
                        <select id="current-term" required>
                            <option value="First Term">First Term</option>
                            <option value="Second Term">Second Term</option>
                            <option value="Third Term">Third Term</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="resumption-date">Next Resumption Date <span class="required">*</span></label>
                        <input type="date" id="resumption-date" required>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn">üíæ Save Settings</button>
                        <button type="button" class="btn btn-secondary" onclick="loadCurrentSettings()">‚Üª Refresh</button>
                    </div>
                </form>
            </div>

            <!-- Start New Session Section -->
            <div class="form-section" style="margin-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300); padding-top: var(--space-xl);">
                <h3 style="color: var(--color-primary);">üéì Start New Academic Session</h3>
                <p style="color: var(--color-gray-700); margin-bottom: var(--space-lg);">
                    Use this when the current session ends. This will archive the current session and create a new one.
                </p>
                
                <div class="alert alert-warning" style="margin-bottom: var(--space-lg);">
                    <strong>‚ö†Ô∏è Important:</strong> Starting a new session will:
                    <ul style="margin: var(--space-sm) 0 0 var(--space-lg);">
                        <li>Archive the current session (2025/2026)</li>
                        <li>Create a new session (2026/2027)</li>
                        <li>Reset current term to "First Term"</li>
                        <li>Enable promotion period for teachers</li>
                    </ul>
                </div>

                <button type="button" class="btn btn-danger" onclick="confirmStartNewSession()" id="start-new-session-btn">
                    üöÄ Start New Session
                </button>
            </div>

            <!-- Session History -->
            <div class="form-section" style="margin-top: var(--space-2xl);">
                <h3>üìö Session History</h3>
                <div id="session-history-container" class="table-container">
                    <table class="responsive-table">
                        <thead>
                            <tr>
                                <th>Session</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="session-history-table">
                            <tr>
                                <td colspan="4" class="table-loading">Loading history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Class Hierarchy Management -->
            <div class="form-section" style="margin-top: var(--space-2xl); border-top: 2px solid var(--color-gray-300); padding-top: var(--space-xl);">
                <h3>üìä Class Progression Order</h3>
                <p style="color: var(--color-gray-700); margin-bottom: var(--space-lg);">
                    Define the order of class progression for automatic promotions. 
                    Pupils will be promoted from one class to the next in this order.
                </p>

                <div class="class-hierarchy-editor">
                    <div class="hierarchy-section">
                        <h4 style="color: var(--color-primary); margin-bottom: var(--space-md);">
                            üßí Nursery Classes
                        </h4>
                        <div id="nursery-hierarchy" class="hierarchy-list">
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">1</span>
                                <input type="text" class="hierarchy-input" value="Nursery 1" data-level="nursery" data-index="0">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('nursery', 0)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">2</span>
                                <input type="text" class="hierarchy-input" value="Nursery 2" data-level="nursery" data-index="1">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('nursery', 1)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                        </div>
                        <button class="btn btn-small" onclick="addHierarchyItem('nursery')" style="margin-top: var(--space-sm);">
                            + Add Nursery Class
                        </button>
                    </div>

                    <div class="hierarchy-section" style="margin-top: var(--space-xl);">
                        <h4 style="color: var(--color-primary); margin-bottom: var(--space-md);">
                            üéì Primary Classes
                        </h4>
                        <div id="primary-hierarchy" class="hierarchy-list">
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">3</span>
                                <input type="text" class="hierarchy-input" value="Primary 1" data-level="primary" data-index="0">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 0)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">4</span>
                                <input type="text" class="hierarchy-input" value="Primary 2" data-level="primary" data-index="1">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 1)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">5</span>
                                <input type="text" class="hierarchy-input" value="Primary 3" data-level="primary" data-index="2">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 2)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">6</span>
                                <input type="text" class="hierarchy-input" value="Primary 4" data-level="primary" data-index="3">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 3)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">7</span>
                                <input type="text" class="hierarchy-input" value="Primary 5" data-level="primary" data-index="4">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 4)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                            <div class="hierarchy-item">
                                <span class="hierarchy-number">8</span>
                                <input type="text" class="hierarchy-input" value="Primary 6" data-level="primary" data-index="5">
                                <button class="btn-icon btn-danger" onclick="removeHierarchyItem('primary', 5)" title="Remove">
                                    ‚úï
                                </button>
                            </div>
                        </div>
                        <button class="btn btn-small" onclick="addHierarchyItem('primary')" style="margin-top: var(--space-sm);">
                            + Add Primary Class
                        </button>
                    </div>

                    <div class="alert alert-info" style="margin-top: var(--space-lg);">
                        <strong>‚ÑπÔ∏è Note:</strong>
                        <ul style="margin: var(--space-sm) 0 0 var(--space-lg);">
                            <li>The last class (bottom) will be the terminal class (no promotion after this)</li>
                            <li>Pupils in the terminal class will be marked as "Graduated" and moved to alumni</li>
                            <li>Make sure class names match exactly with your existing classes</li>
                        </ul>
                    </div>

                    <div class="form-actions" style="margin-top: var(--space-xl);">
                        <button class="btn" onclick="saveHierarchySettings()">
                            üíæ Save Class Order
                        </button>
                        <button class="btn btn-secondary" onclick="resetHierarchyToDefault()">
                            ‚Üª Reset to Default
                        </button>
                    </div>
                </div>
            </div>
        </div>
</div> <!-- Close content-wrapper -->
    </main>

    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script src="firebase-init.js"></script>
    <script src="class-hierarchy.js"></script>
    <script src="admin.js"></script>
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Portal - Fahmid Nursery & Primary School</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/jpeg" href="IMG_4628.jpeg">
        
        <style>
        /* Promotion Section Styles */
        .promotion-banner {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-lg) var(--space-xl);
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .promotion-banner.promotion-disabled {
            background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .banner-icon {
            font-size: 3rem;
            line-height: 1;
        }

        .banner-content {
            flex: 1;
            color: white;
        }

        .banner-content h3 {
            margin: 0 0 var(--space-xs);
            font-size: var(--text-xl);
            font-weight: 700;
        }

        .banner-content p {
            margin: 0;
            font-size: var(--text-base);
            opacity: 0.95;
        }

        .promotion-info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .info-card {
            background: var(--color-gray-50);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
        }

        .info-card-next {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: var(--color-primary);
        }

        .info-label {
            font-size: var(--text-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-gray-600);
            margin-bottom: var(--space-xs);
        }

        .info-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--color-gray-900);
        }

        .promotion-controls {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
        }

        .promotion-controls .btn {
            flex: 1;
            min-width: 150px;
        }

        .status-badge {
            display: inline-block;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-promote {
            background: #4CAF50;
            color: white;
        }

        .status-hold {
            background: #ff9800;
            color: white;
        }

        .alert {
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
        }

        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            color: #0d47a1;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }

        /* Checkbox styling */
        .responsive-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>

    <!-- Replace your current Firebase scripts with these -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="remark-templates.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Hamburger -->
    <button
        class="hamburger hamburger-portal"
        id="hamburger"
        aria-label="Toggle teacher menu"
        aria-expanded="false"
        aria-controls="teacher-sidebar">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Sidebar -->
    <nav class="admin-sidebar teacher-sidebar" id="teacher-sidebar" aria-label="Teacher navigation">
    <!-- Sidebar Header -->
    <div class="sidebar-header-modern">
        <div class="sidebar-logo">
            <i data-lucide="graduation-cap" class="sidebar-logo-icon"></i>
            <span class="sidebar-logo-text">Teacher Portal</span>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar-nav-modern">
        <a href="#dashboard" data-section="dashboard" class="sidebar-link active">
            <i data-lucide="layout-dashboard"></i>
            <span>Dashboard</span>
        </a>
        
        <a href="#my-classes" data-section="my-classes" class="sidebar-link">
            <i data-lucide="users-2"></i>
            <span>My Classes</span>
        </a>
        
        <a href="#enter-results" data-section="enter-results" class="sidebar-link">
            <i data-lucide="clipboard-list"></i>
            <span>Enter Results</span>
        </a>
        
        <a href="#attendance" data-section="attendance" class="sidebar-link">
            <i data-lucide="calendar-check"></i>
            <span>Attendance</span>
        </a>
        
        <a href="#traits-skills" data-section="traits-skills" class="sidebar-link">
            <i data-lucide="award"></i>
            <span>Traits & Skills</span>
        </a>
        
        <a href="#remarks" data-section="remarks" class="sidebar-link">
            <i data-lucide="message-square-text"></i>
            <span>Remarks</span>
        </a>
        
        <a href="#promotions" data-section="promotions" class="sidebar-link">
            <i data-lucide="trending-up"></i>
            <span>Class Promotion</span>
        </a>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer-modern">
        <a href="index.html" class="sidebar-link sidebar-link-secondary">
            <i data-lucide="arrow-left"></i>
            <span>Back to Site</span>
        </a>
        <a href="#" id="teacher-logout" class="sidebar-link sidebar-link-danger">
            <i data-lucide="log-out"></i>
            <span>Logout</span>
        </a>
        <div class="teacher-info" id="teacher-info">Loading...</div>
    </div>
</nav>

    <!-- Main -->
    <main class="admin-main" id="main-content" role="main" tabindex="-1">
<!-- Content Wrapper -->
<div class="content-wrapper">
        <!-- Dashboard -->
        <section id="dashboard" class="admin-card" tabindex="-1">
            <h1>Welcome, Teacher</h1>
            <p class="section-description">Manage your classes and enter pupil reports</p>

            <div class="stats-grid">
                <div class="stat-card stat-card-primary">
                    <h3>My Classes</h3>
                    <div class="stat-number" id="my-class-count">0</div>
                </div>
                <div class="stat-card stat-card-orange">
                    <h3>Pupils Assigned</h3>
                    <div class="stat-number" id="my-pupil-count">0</div>
                </div>
            </div>
        </section>

        <!-- My Classes -->
        <section id="my-classes" class="admin-card" hidden tabindex="-1">
            <h1>My Pupils</h1>
            <p class="section-description">List of all pupils in your assigned classes</p>

            <div class="table-container">
    <table class="responsive-table" id="pupils-in-class-table">
        <thead>
            <tr>
                <th>Pupil Name</th>
                <th>Gender</th>
                <th>Admission No</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3" class="table-loading">Loading pupils...</td>
            </tr>
        </tbody>
    </table>
</div>
        </section>

        <!-- Enter Results -->
        <section id="enter-results" class="admin-card" hidden tabindex="-1">
            <h1>Enter Academic Results</h1>
            <p class="section-description">Enter CA and Exam scores for your pupils</p>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="result-term">Term <span class="required">*</span></label>
                    <select id="result-term" onchange="loadResultsTable()">
                        <option value="First Term">First Term</option>
                        <option value="Second Term">Second Term</option>
                        <option value="Third Term">Third Term</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="result-subject">Subject <span class="required">*</span></label>
                    <select id="result-subject" onchange="loadResultsTable()">
                        <option value="">-- Select Subject --</option>
                    </select>
                </div>
            </div>

            <div id="results-entry-table-container"></div>

            <button class="btn" id="save-results-btn" onclick="saveAllResults()" hidden>
                üíæ Save All Results
            </button>
        </section>

<!-- Result Submission Controls (NEW) -->
<div id="result-submission-controls" style="display:none; margin-top: var(--space-xl); padding: var(--space-xl); background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: var(--radius-lg);">
    <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-lg);">
        <div style="width: 48px; height: 48px; background: #0ea5e9; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
            üìã
        </div>
        <div style="flex: 1;">
            <h3 style="margin: 0; color: #0c4a6e;">Ready to Submit Results?</h3>
            <p style="margin: 0.25rem 0 0; color: #075985; font-size: var(--text-sm);">
                Once submitted, results cannot be edited until admin approval or rejection.
            </p>
        </div>
    </div>
    
    <div style="background: white; padding: var(--space-lg); border-radius: var(--radius-md); margin-bottom: var(--space-lg);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md);">
            <div>
                <div style="font-size: var(--text-xs); color: var(--color-gray-600); margin-bottom: var(--space-xs);">Class</div>
                <div style="font-weight: 600; color: var(--color-gray-900);" id="submission-class-name">-</div>
            </div>
            <div>
                <div style="font-size: var(--text-xs); color: var(--color-gray-600); margin-bottom: var(--space-xs);">Term</div>
                <div style="font-weight: 600; color: var(--color-gray-900);" id="submission-term">-</div>
            </div>
            <div>
                <div style="font-size: var(--text-xs); color: var(--color-gray-600); margin-bottom: var(--space-xs);">Subject</div>
                <div style="font-weight: 600; color: var(--color-gray-900);" id="submission-subject">-</div>
            </div>
            <div>
                <div style="font-size: var(--text-xs); color: var(--color-gray-600); margin-bottom: var(--space-xs);">Pupils</div>
                <div style="font-weight: 600; color: var(--color-gray-900);" id="submission-pupil-count">0</div>
            </div>
        </div>
    </div>
    
    <button class="btn btn-primary" onclick="submitResultsForApproval()" style="width: 100%;">
        üì§ Submit Results for Admin Approval
    </button>
</div>

<!-- Result Locked Banner (NEW) -->
<div id="result-locked-banner" style="display:none; margin-top: var(--space-xl); padding: var(--space-xl); background: #fef3c7; border: 2px solid #f59e0b; border-radius: var(--radius-lg);">
    <div style="display: flex; align-items: start; gap: var(--space-md);">
        <div style="font-size: 32px;">üîí</div>
        <div style="flex: 1;">
            <h3 style="margin: 0 0 var(--space-xs); color: #92400e;">Results Locked</h3>
            <p style="margin: 0; color: #78350f; line-height: 1.6;">
                These results have been approved by admin and are now locked. 
                You cannot make changes unless admin unlocks them first.
            </p>
            <div id="lock-details" style="margin-top: var(--space-md); padding: var(--space-md); background: white; border-radius: var(--radius-sm);">
                <!-- Lock details will be populated here -->
            </div>
        </div>
    </div>
</div>

<!-- Submission Status Banner (NEW) -->
<div id="result-submission-status" style="display:none; margin-top: var(--space-xl); padding: var(--space-xl); background: #e0f2fe; border: 2px solid #0284c7; border-radius: var(--radius-lg);">
    <div style="display: flex; align-items: center; gap: var(--space-md);">
        <div style="font-size: 32px;">‚è≥</div>
        <div style="flex: 1;">
            <h3 style="margin: 0 0 var(--space-xs); color: #0c4a6e;">Pending Admin Approval</h3>
            <p style="margin: 0; color: #075985;">
                You submitted these results on <strong id="submitted-date">-</strong>. 
                Waiting for admin to review and approve.
            </p>
        </div>
    </div>
</div>

        <!-- Attendance -->
        <section id="attendance" class="admin-card" hidden tabindex="-1">
            <h1>Mark Attendance</h1>
            <p class="section-description">Enter attendance records for your pupils</p>

            <div class="form-row">
                <div class="form-group">
                    <label for="attendance-term">Term <span class="required">*</span></label>
                    <select id="attendance-term" onchange="loadAttendanceSection()">
                        <option value="First Term">First Term</option>
                        <option value="Second Term">Second Term</option>
                        <option value="Third Term">Third Term</option>
                    </select>
                </div>
            </div>

            <div id="attendance-form-container"></div>

            <button class="btn" id="save-attendance-btn" onclick="saveAllAttendance()" hidden>
                üíæ Save All Attendance
            </button>
        </section>

        <!-- Traits & Skills -->
        <section id="traits-skills" class="admin-card" hidden>
    <h1>Behavioral Traits & Psychomotor Skills</h1>
    <p class="section-description">Bulk entry for all pupils in your class</p>
    
    <div class="form-row">
        <div class="form-group">
            <label for="traits-term">Term <span class="required">*</span></label>
            <select id="traits-term" onchange="loadBulkTraitsTable()">
                <option value="First Term">First Term</option>
                <option value="Second Term">Second Term</option>
                <option value="Third Term">Third Term</option>
            </select>
        </div>
    </div>
    
    <div id="traits-form-container">
        <!-- Bulk traits grid will be generated here -->
    </div>
</section>

        <!-- Remarks -->
        <section id="remarks" class="admin-card" hidden tabindex="-1">
            <h1>Remarks</h1>
            <p class="section-description">Write remarks for pupils' report cards</p>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="remarks-term">Term <span class="required">*</span></label>
                    <select id="remarks-term" onchange="loadRemarksData()">
                        <option value="First Term">First Term</option>
                        <option value="Second Term">Second Term</option>
                        <option value="Third Term">Third Term</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="remarks-pupil">Pupil <span class="required">*</span></label>
                    <select id="remarks-pupil" onchange="loadRemarksData()">
                        <option value="">-- Select Pupil --</option>
                    </select>
                </div>
            </div>

            <div id="remarks-form-container" class="remarks-form" hidden>
                <div class="form-group">
    <label for="teacher-remark">Teacher's Remark</label>
    
    <!-- Remark Suggestions (NEW) -->
    <div id="remark-suggestions" style="display:none; margin-bottom: var(--space-md); padding: var(--space-md); background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: var(--radius-md);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
            <div>
                <strong style="color: #0c4a6e;">üí° Suggested Remarks</strong>
                <div id="suggestion-info" style="font-size: var(--text-sm); color: #075985; margin-top: 4px;"></div>
            </div>
            <button type="button" class="btn-small btn-secondary" onclick="refreshRemarkSuggestions()">
                üîÑ Refresh
            </button>
        </div>
        <div id="suggestion-buttons" style="display: flex; flex-wrap: wrap; gap: var(--space-sm);"></div>
    </div>
    
    <textarea id="teacher-remark" rows="4" placeholder="Select a suggestion above or write your own remark..."></textarea>
    <small style="color: var(--color-gray-600); display: block; margin-top: var(--space-xs);">
        üí° Click "Load Suggestions" to see remark templates based on pupil's average
    </small>
</div>

                <div class="form-group">
                    <label for="head-remark">Headteacher's Remark</label>
                    <textarea id="head-remark" rows="4"
                        placeholder="Write the headteacher's remark about the pupil's performance..."></textarea>
                </div>

                <button class="btn" onclick="saveRemarks()">
                    üíæ Save Remarks
                </button>
            </div>
        </section>
</div>
<!-- Class Promotion Section (NEW) -->
        <section id="promotions" class="admin-card" hidden tabindex="-1">
            <h1>Class Promotion</h1>
            <p class="section-description">Select pupils to promote to the next class for the upcoming academic session</p>

            <!-- Promotion Period Status -->
            <div id="promotion-status-banner" class="promotion-banner" style="display:none;">
                <div class="banner-icon">üéì</div>
                <div class="banner-content">
                    <h3>Promotion Period Active</h3>
                    <p>You can now submit promotion recommendations for your pupils.</p>
                </div>
            </div>

            <div id="promotion-disabled-banner" class="promotion-banner promotion-disabled" style="display:none;">
                <div class="banner-icon">üîí</div>
                <div class="banner-content">
                    <h3>Promotion Period Not Active</h3>
                    <p>Class promotions can only be submitted when the promotion period is open. Contact admin for more information.</p>
                </div>
            </div>

            <!-- Class & Next Class Info -->
            <div class="promotion-info-cards">
                <div class="info-card">
                    <div class="info-label">Current Class</div>
                    <div class="info-value" id="promotion-current-class">Loading...</div>
                </div>
                <div class="info-card info-card-next">
                    <div class="info-label">Next Class</div>
                    <div class="info-value" id="promotion-next-class">Loading...</div>
                </div>
            </div>

            <!-- Promotion Controls -->
            <div class="promotion-controls" id="promotion-controls" style="display:none;">
                <button class="btn btn-secondary" onclick="selectAllForPromotion()">
                    ‚úì Select All
                </button>
                <button class="btn btn-secondary" onclick="deselectAllForPromotion()">
                    ‚úó Deselect All
                </button>
                <button class="btn" onclick="submitPromotionRequest()" id="submit-promotion-btn">
                    üìã Submit Promotion List
                </button>
            </div>

            <!-- Pupils Table -->
            <div class="table-container" id="promotion-table-container" style="display:none;">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="select-all-pupils-promo" onchange="toggleAllPupilsPromotion(this)">
                            </th>
                            <th>Pupil Name</th>
                            <th>Average Score</th>
                            <th>Grade</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="promotion-pupils-table">
                        <tr>
                            <td colspan="5" class="table-loading">Loading pupils...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Terminal Class Message -->
            <div id="terminal-class-message" class="alert alert-info" style="display:none;">
                <strong>‚ÑπÔ∏è Terminal Class</strong>
                <p>This is the final class in the school hierarchy. Pupils in this class will be marked as "Graduated" and moved to the alumni records when promoted.</p>
            </div>

            <!-- No Class Message -->
            <div id="no-class-message" class="alert alert-warning" style="display:none;">
                <strong>‚ö†Ô∏è No Class Assigned</strong>
                <p>You don't have a class assigned yet. Contact the admin to assign you to a class.</p>
            </div>
        </section>

    </main>

    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="firebase-init.js"></script>
    <script src="class-hierarchy.js"></script>
    <script src="result-locking.js"></script>
    <script src="teacher.js"></script>
<!-- Optimization Scripts -->
<script src="session-cache.js"></script>
<script src="button-loader.js"></script>

<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('‚úì Service Worker registered'))
      .catch(err => console.log('Service Worker registration failed:', err));
  });
}
</script>
</body>
</html>
